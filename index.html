<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Favicon -->
  <link rel="icon" href="raketaFavIcon.ico" type="image/x-icon" />

  <title>Space Labyrinth</title>

  <!-- Google Font: Orbitron -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet" />

  <!-- SweetAlert2 (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    /********************************************************
     *  1) Splošno ozadje z “zvezdami” + animiran gradient
     ********************************************************/
    html, body {
      margin: 0; 
      padding: 0; 
      box-sizing: border-box;
      height: 100%;
      font-family: Arial, sans-serif; 
      color: #fff;
    }
    body {
      /* Svetlejša vesoljska barva v ozadju */
      background: linear-gradient(120deg, #4c7b9e, #0d4b8d, #002046);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;

      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: relative;
      overflow-x: hidden;
    }
    @keyframes gradientShift {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Velike “zvezdice” */
    body::before {
      content: "";
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
      background:
        radial-gradient(3px 3px at 40px 40px, #fff, transparent 80%) repeat,
        radial-gradient(3px 3px at 100px 100px, #fff, transparent 80%) repeat;
      background-size: 120px 120px; 
      opacity: 0.3;
      animation: starDrift 40s linear infinite;
    }
    @keyframes starDrift {
      100% {
        background-position: -1200px -1200px;
      }
    }

    /********************************************************
     *  2) Zaglavje (naslov)
     ********************************************************/
    .glava {
      position: relative;
      z-index: 1;
      width: 100%;
      text-align: center;
      padding: 20px;
      background: rgba(0,0,0,0.2);
    }
    .glava h1 {
      margin: 0;
      font-family: 'Orbitron', Arial, sans-serif;
      font-size: 2.5rem;
      color: #fff;
      /* Neonski sijaj */
      text-shadow:
        0 0 5px  rgba(255,255,255,0.6),
        0 0 10px rgba(255,255,255,0.4),
        0 0 20px rgba(255,255,255,0.2);
    }

    /********************************************************
     *  3) Glavni container (labirint + gumbi)
     ********************************************************/
    .container {
      position: relative;
      z-index: 1;
      width: 90%;
      max-width: 600px;
      margin: 20px auto;
      text-align: center;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      padding: 20px;
      transition: transform 0.2s;
    }
    .container:hover {
      transform: scale(1.03);
    }

    /* Maze wrapper s SVG in canvas, odzivno */
    #mazeWrapper {
      position: relative; 
      display: inline-block;
      width: 100%;
      max-width: 484px; /* da se ne napihne preveč */
    }
    #mazeWrapper svg {
      width: 100%;
      height: auto;
      display: block;
    }
    /* Canvas nad SVG */
    #drawCanvas {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: auto;
      z-index: 2;
      cursor: crosshair;
    }

    /********************************************************
     *  4) Gumbi
     ********************************************************/
    .gumbi {
      margin-top: 15px;
    }
    .btn {
      display: inline-block;
      margin: 5px;
      padding: 10px 20px;
      background-color: #28ca43;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn:hover {
      background: #02551b;
      transform: scale(1.05);
    }
    /* Gumb glasba */
    #btnMusic.on {
      background-color: #db2777; /* roza? */
    }

    /********************************************************
     *  5) Rešitvena pot (solution-path) - animacija
     ********************************************************/
    .solution-path {
      stroke-dasharray: 3000; 
      stroke-dashoffset: 3000;
      transition: stroke-dashoffset 3s linear;
      filter: drop-shadow(0 0 8px lime);
    }
    .solution-path.draw {
      stroke-dashoffset: 0;
    }

    /********************************************************
     *  6) Info (skrito polje)
     ********************************************************/
    .info-box {
      display: none;
      margin-top: 15px;
      background: rgba(255,255,255,0.1);
      padding: 10px;
      border-radius: 5px;
      animation: fadeIn 0.4s ease;
    }
    @keyframes fadeIn {
      from {opacity: 0;}
      to   {opacity: 1;}
    }

    /********************************************************
     *  7) Noga (footer)
     ********************************************************/
    .noga {
      width: 100%;
      text-align: center;
      background: rgba(0,0,0,0.2);
      padding: 10px;
      margin-top: auto;
      z-index: 1;
    }
  </style>
</head>

<body>
  <div class="glava">
    <h1>Explore the Space Labyrinth</h1>
  </div>

  <div class="container">
    <div id="mazeWrapper">
      <!-- Tu se vstavi maze.svg s fetch() -->
      <canvas id="drawCanvas" width="484" height="484"></canvas>
    </div>

    <div class="gumbi">
      <button id="btnShow"   class="btn">Show Solution</button>
      <button id="btnHide"   class="btn" style="display:none;">Hide Solution</button>
      <button id="btnInfo"   class="btn">More Info</button>
      <button id="btnClear"  class="btn">Clear Drawing</button>
      <button id="btnMusic"  class="btn">Music On/Off</button>
    </div>

    <div id="infoBox" class="info-box">
      <p><strong>Navodila:</strong></p>
      <ul style="text-align:left;">
        <li>Začni risati <em>v bližini</em> (234,8) (vhod) — sicer se črta ne bo začela.</li>
        <li>Če se dotakneš stene: Game Over.</li>
        <li>Če prideš do spodnje luknje (242..258, y=482): You Win!</li>
      </ul>
      <p>
        Klikni “Show Solution” za rešitveno pot, “Hide Solution” za skrivanje, 
        “Clear Drawing” za čiščenje narisanega.
      </p>
    </div>
  </div>

  <div class="noga">
    <p>&copy; 2025 Space Labyrinth</p>
  </div>

  <!-- Glasba v ozadju (postaviš svojo .mp3 v mapo ali uporabiš spletni URL) -->
  <audio id="bgMusic" src="SpaceMusic.mp3" loop preload="auto"></audio>

  <script>
    /****************************************************
     * (A) Naložimo maze.svg in stene
     ****************************************************/
    let walls = [];
    fetch("maze.svg")
      .then(res => res.text())
      .then(svgData => {
        const mazeWrapper = document.getElementById("mazeWrapper");
        mazeWrapper.insertAdjacentHTML("afterbegin", svgData);

        const svgEl = mazeWrapper.querySelector("svg");
        const lineElems = svgEl.querySelectorAll("line");
        lineElems.forEach(ln => {
          let x1 = parseFloat(ln.getAttribute("x1"));
          let y1 = parseFloat(ln.getAttribute("y1"));
          let x2 = parseFloat(ln.getAttribute("x2"));
          let y2 = parseFloat(ln.getAttribute("y2"));
          walls.push({x1,y1,x2,y2});
        });
      })
      .catch(err => console.error("Napaka pri nalaganju SVG:", err));

    /****************************************************
     * (B) Gumbi: Show/Hide, Info, Clear, Music
     ****************************************************/
    const btnShow   = document.getElementById("btnShow");
    const btnHide   = document.getElementById("btnHide");
    const btnInfo   = document.getElementById("btnInfo");
    const btnClear  = document.getElementById("btnClear");
    const btnMusic  = document.getElementById("btnMusic");
    const infoBox   = document.getElementById("infoBox");
    const bgMusic   = document.getElementById("bgMusic");

    // Show/Hide rešitve
    btnShow.addEventListener("click", () => {
      const solPath = document.querySelector(".solution-path");
      if (solPath) solPath.classList.add("draw");
      btnShow.style.display="none";
      btnHide.style.display="inline-block";
    });
    btnHide.addEventListener("click", () => {
      const solPath = document.querySelector(".solution-path");
      if (solPath) solPath.classList.remove("draw");
      btnHide.style.display="none";
      btnShow.style.display="inline-block";
    });

    // Info
    let infoVisible=false;
    btnInfo.addEventListener("click", () => {
      infoVisible=!infoVisible;
      infoBox.style.display=infoVisible?"block":"none";
      btnInfo.textContent=infoVisible?"Hide Info":"More Info";
    });

    // Clear
    btnClear.addEventListener("click", () => {
      ctx.clearRect(0,0, drawCanvas.width, drawCanvas.height);
      drawingStarted=false;
    });

    // Glasba On/Off
    let musicOn=false;
    btnMusic.addEventListener("click", () => {
      musicOn=!musicOn;
      if (musicOn) {
        bgMusic.play();
        btnMusic.classList.add("on");
      } else {
        bgMusic.pause();
        btnMusic.classList.remove("on");
      }
    });

    /****************************************************
     * (C) Risanje s miško: samo če začnemo pri (234,8)
     ****************************************************/
    const drawCanvas=document.getElementById("drawCanvas");
    const ctx=drawCanvas.getContext("2d");

    // Lepša modra črta + sijaj
    ctx.strokeStyle="#00aeff";
    ctx.lineWidth=4;
    ctx.lineCap="round";
    ctx.shadowColor="#0cf";
    ctx.shadowBlur=10;

    let isDrawing=false;
    let drawingStarted=false; // ali smo že “legalno” začeli pri vhodu?
    let lastX=234, lastY=8;
    const startX=234, startY=8;
    const threshold=20; // polmer za “bližino” starta

    // Mousedown -> poskus začetka ali nadaljevanja
    drawCanvas.addEventListener("mousedown", (ev) => {
      const [mx,my]=getMousePos(ev);
      if (!drawingStarted) {
        let dx=mx - startX, dy=my - startY;
        let dist2=dx*dx + dy*dy;
        if (dist2 <= threshold*threshold) {
          // Dovolj blizu vhoda => začnemo
          drawingStarted=true;
          isDrawing=true;
          lastX=mx; lastY=my;
        } else {
          // predaleč
          isDrawing=false;
        }
      } else {
        // Že imamo risanje
        isDrawing=true;
        lastX=mx; lastY=my;
      }
    });

    // Mousemove -> če rišemo, narišemo in preverimo stene/izhod
    drawCanvas.addEventListener("mousemove", (ev) => {
      if (!isDrawing) return;
      const [nx,ny]=getMousePos(ev);

      // 1) narišemo segment
      ctx.beginPath();
      ctx.moveTo(lastX,lastY);
      ctx.lineTo(nx,ny);
      ctx.stroke();

      // 2) preverimo, ali seka katero steno => gameOver
      if (lineHitsWall(lastX,lastY,nx,ny)) {
        gameOver();
        return;
      }
      // 3) preverimo izhod (242..258, y=482)
      if (lineSegmentsIntersect(lastX,lastY,nx,ny, 242,482, 258,482)) {
        youWin();
        return;
      }

      lastX=nx; 
      lastY=ny;
    });
    drawCanvas.addEventListener("mouseup",   ()=>{isDrawing=false;});
    drawCanvas.addEventListener("mouseleave",()=>{isDrawing=false;});

    // Transform mouse => (0..484)
    function getMousePos(e) {
      const rect=drawCanvas.getBoundingClientRect();
      const scx=drawCanvas.width/rect.width;
      const scy=drawCanvas.height/rect.height;
      const x=(e.clientX-rect.left)*scx;
      const y=(e.clientY-rect.top)*scy;
      return [x,y];
    }

    /****************************************************
     * (D) lineHitsWall => true, če segment seka katero steno
     ****************************************************/
    function lineHitsWall(x1,y1,x2,y2) {
      for (let w of walls) {
        if (lineSegmentsIntersect(x1,y1,x2,y2, w.x1,w.y1,w.x2,w.y2)) {
          return true;
        }
      }
      return false;
    }

    // lineSegmentsIntersect => klasičen “orientation” test
    function lineSegmentsIntersect(ax,ay,bx,by, cx,cy,dx,dy) {
      function orientation(px,py, qx,qy, rx,ry) {
        let val=(qy-py)*(rx-qx)-(qx-px)*(ry-qy);
        if(val===0)return 0;return (val>0?1:2);
      }
      function onSegment(px,py,qx,qy,rx,ry){
        return(Math.min(px,rx)<=qx&&qx<=Math.max(px,rx)&&
               Math.min(py,ry)<=qy&&qy<=Math.max(py,ry));
      }
      const o1=orientation(ax,ay,bx,by,cx,cy), o2=orientation(ax,ay,bx,by,dx,dy);
      const o3=orientation(cx,cy,dx,dy,ax,ay), o4=orientation(cx,cy,dx,dy,bx,by);
      if(o1!==o2&&o3!==o4)return true;
      if(o1===0&&onSegment(ax,ay,cx,cy,bx,by))return true;
      if(o2===0&&onSegment(ax,ay,dx,dy,bx,by))return true;
      if(o3===0&&onSegment(cx,cy,ax,ay,dx,dy))return true;
      if(o4===0&&onSegment(cx,cy,bx,by,dx,dy))return true;
      return false;
    }

    /****************************************************
     * (E) gameOver / youWin + reset
     ****************************************************/
    function gameOver() {
      Swal.fire({
        icon:"error",
        title:"Game Over",
        text:"Zadeli ste steno labirinta!",
        confirmButtonText:"Ok"
      }).then(()=>resetDrawing());
    }
    function youWin() {
      Swal.fire({
        icon:"success",
        title:"You Win!",
        text:"Uspešno ste prišli do izhoda labirinta!",
        confirmButtonText:"Super"
      }).then(()=>resetDrawing());
    }
    function resetDrawing() {
      ctx.clearRect(0,0, drawCanvas.width, drawCanvas.height);
      drawingStarted=false;
    }
  </script>
</body>
</html>
